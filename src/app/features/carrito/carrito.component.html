<div class="max-w-4xl mx-auto px-4 py-8">
  <h1 class="text-3xl font-black text-chocolate mb-6">Tu Carrito</h1>

  @if (carrito.items().length === 0) {
    <div class="text-center py-20">
      <fa-icon [icon]="faCartShopping" class="text-6xl mb-4"></fa-icon>
      <p class="text-gray-500 text-xl font-medium mb-4">Tu carrito está vacío</p>
      <a routerLink="/menu" class="btn-chocolate inline-block">Ver el Menú</a>
    </div>
  }

  @if (carrito.items().length > 0) {
    <div class="grid lg:grid-cols-3 gap-8">

      <!-- Lista de items -->
      <div class="lg:col-span-2 space-y-4">
        @for (item of carrito.items(); track item.producto.id) {
          <div class="card p-4 flex items-center gap-4">
            <!-- Imagen -->
            <div class="w-16 h-16 bg-menta rounded-xl flex items-center justify-center overflow-hidden flex-shrink-0">
              @if (item.producto.imagen_url) {
                <img [src]="item.producto.imagen_url" [alt]="item.producto.nombre" class="w-full h-full object-cover">
              } @else {
                <fa-icon [icon]="faCookieBite" class="text-2xl text-yellow-800"></fa-icon>
              }
            </div>

            <!-- Info -->
            <div class="flex-1 min-w-0">
              <p class="font-bold text-chocolate truncate">{{ item.producto.nombre }}</p>
              <p class="text-sm text-gray-500">{{ item.producto.precio | currency:'EUR':'symbol':'1.2-2' }} / ud</p>
            </div>

            <!-- Cantidad -->
            <div class="flex items-center gap-2">
              <button (click)="carrito.actualizarCantidad(item.producto.id, item.cantidad - 1)"
                class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 font-bold text-lg transition-colors flex items-center justify-center">
                -
              </button>
              <span class="w-8 text-center font-bold text-chocolate">{{ item.cantidad }}</span>
              <button (click)="carrito.actualizarCantidad(item.producto.id, item.cantidad + 1)"
                class="w-8 h-8 rounded-full bg-churro hover:bg-opacity-80 font-bold text-lg transition-colors flex items-center justify-center">
                +
              </button>
            </div>

            <!-- Subtotal -->
            <div class="text-right min-w-[5rem]">
              <p class="font-bold text-chocolate">{{ item.producto.precio * item.cantidad | currency:'EUR':'symbol':'1.2-2' }}</p>
            </div>

            <!-- Eliminar -->
            <button (click)="carrito.quitar(item.producto.id)"
              class="text-red-400 hover:text-red-600 transition-colors ml-1">
              <fa-icon [icon]="faXMark" class="text-xl"></fa-icon>
            </button>
          </div>
        }

        <button (click)="carrito.vaciar()" class="text-sm text-red-500 hover:underline mt-2">
          Vaciar carrito
        </button>
      </div>

      <!-- Resumen + Formulario pedido -->
      <div class="space-y-4">
        <!-- Resumen de precios -->
        <div class="card p-6">
          <h2 class="font-black text-chocolate text-lg mb-4">Resumen</h2>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between text-gray-600">
              <span>{{ carrito.totalItems() }} artículo(s)</span>
              <span>{{ carrito.total() | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>
          </div>
          <div class="border-t border-gray-100 mt-4 pt-4 flex justify-between font-black text-chocolate text-xl">
            <span>Total</span>
            <span>{{ carrito.total() | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
        </div>

        <!-- Formulario del pedido -->
        <div class="card p-6">
          <h2 class="font-black text-chocolate text-lg mb-4">Datos del pedido</h2>

          @if (errorMsg) {
            <div class="mb-3 bg-red-50 text-red-700 rounded-xl px-3 py-2 text-sm"><fa-icon [icon]="faCircleExclamation" class="mr-1"></fa-icon> {{ errorMsg }}</div>
          }

          <form [formGroup]="pedidoForm" (ngSubmit)="confirmarPedido()" class="space-y-3">

            <div>
              <label class="label-field">Método de pago *</label>
              <select formControlName="metodo_pago" class="input-field">
                <option value="">Selecciona...</option>
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="bizum">Bizum</option>
              </select>
            </div>

            <div>
              <label class="label-field">Teléfono de contacto</label>
              <input type="tel" formControlName="telefono_contacto" class="input-field" placeholder="612345678">
            </div>

            <div>
              <label class="label-field">Observaciones</label>
              <textarea formControlName="notas" class="input-field resize-none h-16" placeholder="Sin azúcar, extra chocolate..."></textarea>
            </div>

            <button type="submit" [disabled]="pedidoForm.invalid || procesando"
              class="btn-chocolate w-full disabled:opacity-60">
              {{ procesando ? 'Procesando…' : 'Confirmar Pedido' }}
            </button>
          </form>
        </div>
      </div>
    </div>
  }
</div>
