<div class="max-w-4xl mx-auto px-4 py-8" *transloco="let t">
  <h1 class="text-3xl font-black text-chocolate dark:text-crema mb-6">{{ t('CART.TITLE') }}</h1>

  @if (carrito.items().length === 0) {
    <div class="text-center py-20">
      <fa-icon [icon]="faCartShopping" class="text-6xl mb-4 text-chocolate dark:text-crema"></fa-icon>
      <p class="text-gray-500 dark:text-gray-300 text-xl font-medium mb-4">{{ t('CART.EMPTY_CART') }}</p>
      <a routerLink="/menu" class="btn-chocolate inline-block">{{ t('CART.VIEW_MENU') }}</a>
    </div>
  }

  @if (carrito.items().length > 0) {
    <div class="grid lg:grid-cols-3 gap-8">

      <!-- Lista de items -->
      <div class="lg:col-span-2 space-y-4">
        @for (item of carrito.items(); track item.producto.id) {
          <div class="card p-4 flex items-center gap-4">
            <!-- Imagen -->
            <div class="w-16 h-16 bg-menta dark:bg-menta/30 rounded-xl flex items-center justify-center overflow-hidden flex-shrink-0">
              @if (item.producto.imagen_url) {
                <img [src]="item.producto.imagen_url" [alt]="item.producto.nombre" class="w-full h-full object-cover">
              } @else {
                <fa-icon [icon]="faCookieBite" class="text-2xl text-yellow-800"></fa-icon>
              }
            </div>

            <!-- Info -->
            <div class="flex-1 min-w-0">
              <p class="font-bold text-chocolate dark:text-crema truncate">{{ item.producto.nombre }}</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">{{ item.producto.precio | currency:'EUR':'symbol':'1.2-2' }} {{ t('CART.UNIT') }}</p>
            </div>

            <!-- Cantidad -->
            <div class="flex items-center gap-2">
              <button (click)="carrito.actualizarCantidad(item.producto.id, item.cantidad - 1)"
                class="w-8 h-8 rounded-full bg-gray-100 dark:bg-dark-input hover:bg-gray-200 dark:hover:bg-dark-hover font-bold text-lg transition-colors flex items-center justify-center dark:text-crema">
                -
              </button>
              <span class="w-8 text-center font-bold text-chocolate dark:text-crema">{{ item.cantidad }}</span>
              <button (click)="carrito.actualizarCantidad(item.producto.id, item.cantidad + 1)"
                class="w-8 h-8 rounded-full bg-churro hover:bg-opacity-80 font-bold text-lg transition-colors flex items-center justify-center">
                +
              </button>
            </div>

            <!-- Subtotal -->
            <div class="text-right min-w-[5rem]">
              <p class="font-bold text-chocolate dark:text-crema">{{ item.producto.precio * item.cantidad | currency:'EUR':'symbol':'1.2-2' }}</p>
            </div>

            <!-- Eliminar -->
            <button (click)="carrito.quitar(item.producto.id)"
              class="text-red-400 hover:text-red-600 transition-colors ml-1">
              <fa-icon [icon]="faXMark" class="text-xl"></fa-icon>
            </button>
          </div>
        }

        <button (click)="carrito.vaciar()" class="text-sm text-red-500 hover:underline mt-2">
          {{ t('CART.EMPTY_CART_BTN') }}
        </button>
      </div>

      <!-- Resumen + Formulario pedido -->
      <div class="space-y-4">
        <!-- Resumen de precios -->
        <div class="card p-6">
          <h2 class="font-black text-chocolate dark:text-crema text-lg mb-4">{{ t('CART.SUMMARY') }}</h2>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between text-gray-600 dark:text-gray-300">
              <span>{{ carrito.totalItems() }} {{ t('CART.ITEMS') }}</span>
              <span>{{ carrito.total() | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>
          </div>
          <div class="border-t border-gray-100 dark:border-dark-hover mt-4 pt-4 flex justify-between font-black text-chocolate dark:text-crema text-xl">
            <span>{{ t('CART.TOTAL') }}</span>
            <span>{{ carrito.total() | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
        </div>

        <!-- Formulario del pedido -->
        <div class="card p-6">
          <h2 class="font-black text-chocolate dark:text-crema text-lg mb-4">{{ t('CART.ORDER_DATA') }}</h2>

          @if (errorMsg) {
            <div class="mb-3 bg-red-50 text-red-700 rounded-xl px-3 py-2 text-sm"><fa-icon [icon]="faCircleExclamation" class="mr-1"></fa-icon> {{ errorMsg }}</div>
          }

          <form [formGroup]="pedidoForm" (ngSubmit)="confirmarPedido()" class="space-y-3">

            <div>
              <label class="label-field">{{ t('CART.PAYMENT_METHOD') }}</label>
              <select formControlName="metodo_pago" class="input-field">
                <option value="">{{ t('CART.SELECT_PAYMENT') }}</option>
                <option value="efectivo">{{ t('CART.CASH') }}</option>
                <option value="tarjeta">{{ t('CART.CARD') }}</option>
                <option value="bizum">{{ t('CART.BIZUM') }}</option>
              </select>
            </div>

            <div>
              <label class="label-field">{{ t('CART.CONTACT_PHONE') }}</label>
              <input type="tel" formControlName="telefono_contacto" class="input-field" [placeholder]="t('CART.PLACEHOLDER_PHONE')">
            </div>

            <div>
              <label class="label-field">{{ t('CART.NOTES') }}</label>
              <textarea formControlName="notas" class="input-field resize-none h-16" [placeholder]="t('CART.PLACEHOLDER_NOTES')"></textarea>
            </div>

            <button type="submit" [disabled]="pedidoForm.invalid || procesando"
              class="btn-chocolate w-full disabled:opacity-60">
              {{ procesando ? t('CART.PROCESSING') : t('CART.CONFIRM_ORDER') }}
            </button>
          </form>
        </div>
      </div>
    </div>
  }
</div>
