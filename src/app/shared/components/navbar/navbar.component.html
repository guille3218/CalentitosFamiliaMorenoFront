<nav class="bg-chocolate shadow-lg sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      <!-- Logo + Nombre -->
      <a routerLink="/menu" class="flex items-center gap-3 group">
        <div class="w-10 h-10 bg-churro rounded-full flex items-center justify-center shadow-md group-hover:scale-105 transition-transform">
          <img src="assets/img/logo.png" alt="Logo">
        </div>
        <div class="hidden sm:block">
          <p class="text-crema font-black text-lg leading-none tracking-tight">Calentitos</p>
          <p class="text-churro text-xs font-medium tracking-wider">Familia Moreno</p>
        </div>
      </a>

      <!-- Navegación central (Solo Desktop) -->
      <div class="hidden md:flex items-center gap-1">
        <a routerLink="/menu"
           routerLinkActive="text-churro font-bold border-churro"
           class="text-crema border-b-2 border-transparent px-3 py-1 text-sm font-medium hover:text-churro transition-colors">
          Menú
        </a>

        @if (auth.isLoggedIn() && !auth.isAdmin()) {
          <a routerLink="/mis-pedidos"
             routerLinkActive="text-churro font-bold border-churro"
             class="text-crema border-b-2 border-transparent px-3 py-1 text-sm font-medium hover:text-churro transition-colors">
            Mis Pedidos
          </a>
        }

        @if (auth.isAdmin()) {
          <a routerLink="/admin/pedidos"
             routerLinkActive="text-churro font-bold border-churro"
             class="text-crema border-b-2 border-transparent px-3 py-1 text-sm font-medium hover:text-churro transition-colors">
            Pedidos
          </a>
          <a routerLink="/admin/usuarios"
             routerLinkActive="text-churro font-bold border-churro"
             class="text-crema border-b-2 border-transparent px-3 py-1 text-sm font-medium hover:text-churro transition-colors">
            Usuarios
          </a>
        }
      </div>

      <!-- Acciones derecha -->
      <div class="flex items-center gap-2">

        @if (auth.isLoggedIn() && !auth.isAdmin()) {
          <!-- Icono carrito con badge siempre visible -->
          <a routerLink="/carrito" class="relative p-2 text-crema hover:text-churro transition-colors">
            <fa-icon [icon]="faCartShopping" ></fa-icon>
            @if (carrito.totalItems() > 0) {
              <span class="absolute -top-1 -right-1 bg-churro text-chocolate text-xs font-black w-5 h-5 rounded-full flex items-center justify-center animate-pulse">
                {{ carrito.totalItems() }}
              </span>
            }
          </a>
        }

        <!-- Contenedor Auth (Solo Desktop) -->
        <div class="hidden md:flex items-center gap-2 ml-2">
          @if (auth.isLoggedIn()) {
            <!-- Avatar + nombre -->
            <div class="w-8 h-8 bg-menta rounded-full flex items-center justify-center">
              <span class="text-chocolate font-bold text-sm">{{ auth.currentUser()?.nombre?.[0] | uppercase }}</span>
            </div>
            <span class="text-crema text-sm font-medium">{{ auth.currentUser()?.nombre }}</span>
            @if (auth.isAdmin()) {
              <span class="bg-churro text-chocolate text-xs font-bold px-2 py-0.5 rounded-full">Admin</span>
            }
            <!-- Logout -->
            <button (click)="logout()"
              class="ml-1 text-crema hover:text-red-300 transition-colors p-1" title="Cerrar sesión">
              <fa-icon [icon]="faArrowRightFromBracket" ></fa-icon>
            </button>
          } @else {
            <a routerLink="/login" class="text-crema text-sm font-semibold hover:text-churro transition-colors px-3 py-1">
              Iniciar sesión
            </a>
            <a routerLink="/register" class="bg-churro text-chocolate text-sm font-bold px-4 py-1.5 rounded-xl hover:bg-opacity-90 transition-all">
              Registrarse
            </a>
          }
        </div>

        <!-- Botón modo oscuro -->
        <button (click)="theme.toggle()"
          title="{{ theme.isDark() ? 'Modo claro' : 'Modo oscuro' }}"
          class="p-2 w-10 h-10 rounded-full text-crema hover:bg-white/10 transition-all duration-200 active:scale-90 flex items-center justify-center">
          <div class="transition-transform duration-300"
            [style.transform]="theme.isDark() ? 'rotate(0deg)' : 'rotate(-180deg)'">
            @if (theme.isDark()) {
              <fa-icon [icon]="faSun" class="text-xl text-yellow-300"></fa-icon>
            } @else {
              <fa-icon [icon]="faMoon" class="text-xl"></fa-icon>
            }
          </div>
        </button>

        <!-- Botón Menú Móvil -->
        <button (click)="toggleMobileMenu()" class="md:hidden p-2 text-crema hover:text-churro transition-colors ml-1 text-2xl">
          @if (!isMobileMenuOpen) {
            <fa-icon [icon]="faBars"></fa-icon>
          } @else {
            <fa-icon [icon]="faXmark"></fa-icon>
          }
        </button>

      </div>
    </div>
  </div>

  <!-- Menú Móvil Desplegable -->
  @if (isMobileMenuOpen) {
    <div class="md:hidden bg-chocolate border-t border-churro/20 shadow-inner animate-fade-in-down">
      <div class="px-4 py-4 flex flex-col gap-2">
        <a routerLink="/menu" (click)="toggleMobileMenu()" routerLinkActive="text-churro font-bold border-churro" class="text-crema py-2 block border-l-4 border-transparent pl-3 transition-colors">
          Menú
        </a>
        @if (auth.isLoggedIn()) {
          <a routerLink="/mis-pedidos" (click)="toggleMobileMenu()" routerLinkActive="text-churro font-bold border-churro" class="text-crema py-2 block border-l-4 border-transparent pl-3 transition-colors">
            Mis Pedidos
          </a>
        }
        @if (auth.isAdmin()) {
          <a routerLink="/admin/pedidos" (click)="toggleMobileMenu()" routerLinkActive="text-churro font-bold border-churro" class="text-crema py-2 block border-l-4 border-transparent pl-3 transition-colors">
            Pedidos
          </a>
          <a routerLink="/admin/usuarios" (click)="toggleMobileMenu()" routerLinkActive="text-churro font-bold border-churro" class="text-crema py-2 block border-l-4 border-transparent pl-3 transition-colors">
            Usuarios
          </a>
        }

        <hr class="border-churro/20 my-2">

        <div class="pl-2">
          @if (auth.isLoggedIn()) {
            <div class="flex items-center gap-3 py-3">
              <div class="w-10 h-10 bg-menta rounded-full flex items-center justify-center">
                <span class="text-chocolate font-bold">{{ auth.currentUser()?.nombre?.[0] | uppercase }}</span>
              </div>
              <div>
                <p class="text-crema font-bold">{{ auth.currentUser()?.nombre }}</p>
                <p class="text-xs text-crema/70">{{ auth.currentUser()?.email }}</p>
              </div>
            </div>
            <button (click)="logout(); toggleMobileMenu()" class="w-full text-left text-red-400 py-3 flex items-center gap-2 hover:text-red-300 transition-colors">
              <fa-icon [icon]="faArrowRightFromBracket" ></fa-icon>
              Cerrar sesión
            </button>
          } @else {
            <div class="flex flex-col gap-3 mt-2">
              <a routerLink="/login" (click)="toggleMobileMenu()" class="text-crema py-2 text-center border border-churro/50 rounded-xl hover:bg-churro/10 transition-colors">
                Iniciar sesión
              </a>
              <a routerLink="/register" (click)="toggleMobileMenu()" class="bg-churro text-chocolate py-2 text-center font-bold rounded-xl hover:bg-opacity-90 transition-all">
                Registrarse
              </a>
            </div>
          }
        </div>
      </div>
    </div>
  }
</nav>
